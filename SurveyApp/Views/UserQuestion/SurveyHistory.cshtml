@using System.Data;
@{
    ViewBag.Title = "eBit - Survey History";
    Layout = "~/Views/Shared/_Layout.cshtml";

    DataSet ds = (DataSet)Model;

    string childName = string.Empty, survey = string.Empty;
    if(ds.Tables.Count > 1 && ds.Tables[1] != null && ds.Tables[1].Rows.Count > 0)
    {
        childName = ds.Tables[1].Rows[0]["Name"] != DBNull.Value ? Convert.ToString(ds.Tables[1].Rows[0]["Name"]) : string.Empty;
    }

    if (ds.Tables.Count > 2 && ds.Tables[2] != null && ds.Tables[2].Rows.Count > 0)
    {
        survey = ds.Tables[2].Rows[0]["Title"] != DBNull.Value ? Convert.ToString(ds.Tables[2].Rows[0]["Title"]) : string.Empty;
    }
}

<script type="text/javascript">
    $(function () {
        $("#tblSurveys").DataTable({ dom: 'Bfrtip', buttons: [{ extend: 'excel', text: "Export to Excel", title: 'Questionnaires', exportOptions: { modifier: { search: 'none', order: 'original' } } }], "oLanguage": { "sInfo": "Displaying _START_ to _END_ of _TOTAL_ Questionnaire(s)" } });
    });
</script>

<div>
    <h3 class="col-sm-11" style="margin: 0px;padding: 0px;">
        @if(ViewBag.ChildId > 0)
        {
            <a href="javascript:void(0);" id="back" onclick="location.href='@Url.Action("Index", "UserQuestion")?childIdts=@ViewBag.ChildId'"></a>
        }
        else
        {
            <a href="javascript:void(0);" id="back" onclick="goBack(this);"></a>
        }
        &nbsp;@survey&nbsp;-&nbsp;History
    </h3>
</div>
<div style="clear:both;"></div>
<br />
<style>
    .table-hover tbody tr {
        cursor: pointer;
    }

    #tblStudies .name {
        text-transform: capitalize;
    }

    #tblStudies .text-success {
        color: #33b86c;
    }

    #tblStudies .text-danger {
        color: #ef5350;
    }
</style>
<table class="table table-striped table-hover" id="tblSurveys">
    <thead>
        <tr>
            <th>Questionnaire</th>            
            <th>Submitted On</th>
            <th>Score</th>            
        </tr>
    </thead>
    <tbody>
        @foreach (System.Data.DataRow dr in ds.Tables[0].Rows)
        {
            <tr onclick="location.href = '@Url.Action("Question", "UserQuestion", new { surveyID = dr["SurveyId"], ChildId = dr["ChildId"], ChildName = dr["ChildName"], perioddate = Convert.ToDateTime(dr["ScheduleDate"]).ToString(), schid = dr["ScheduleId"] })';">
                <td class="name">@dr["Title"]</td>
                <td>@(dr["SubmitDate"] != DBNull.Value ? Convert.ToDateTime(dr["SubmitDate"]).ToShortDateString() : "")</td>
                <td>@dr["Score"]</td>
            </tr>
        }
    </tbody>
</table>
